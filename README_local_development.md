## Installation of TaxBrain and Related Packages for Local Development

First see the [main README.md for webapp-public](https://github.com/OpenSourcePolicyCenter/webapp-public/blob/master/README.md) to see the necessary steps for running webapp-public, such as installing Postgres and building static assets.

Then read this page about details of how `conda` works and other installation info.  It may be helpful for developers on TaxBrain who want to run the app locally or experimentally with modifications to the dependencies of:
 * [Tax-Calculator](https://github.com/open-source-economics/Tax-Calculator)
 * [OG-USA](https://github.com/open-source-economics/OG-USA)
 * [B-Tax](https://github.com/open-source-economics/B-Tax)

## Create the `aei_dropq` environment

Run the `install_taxbrain_server.sh` script from the `deploy` folder inside your clone of this `webapp-public` repo:


```
cd webapp-public/deploy
. install_taxbrain_server.sh
```

## Make sure old packages are removed

Make sure you remove your existing installation(s) of these open-source-economics packages.  If you have installed with `setup.py`, then `pip uninstall` is needed, or if you have installed with `conda`, then `conda remove` is required.  The easiest way to make sure you clean your environment is to just run both the `pip uninstall` and `conda remove` for each package to be removed (in case you forgot how you installed it).  The following will remove any installations of the three open-source-economics packages:

```
conda remove taxcalc;pip uninstall -y taxcalc
conda remove ogusa;pip uninstall -y ogusa
conda remove btax;pip uninstall -y btax
```
Errors generated by the commands above can be safely ignored (e.g. cannot remove a package because it was not already installed).

It should install everything except for the open-source-economics packages you need.  Those packages are left out of the quick installation script because there is almost always a need to customize their installation.

## Install the open-source-economics packages

Next decide which versions or branches of the open-source-economics packages you want to install and run.  Choices:

 * Install with `setup.py`: Using `setup.py` to install the master git branch, a different git branch, or a tagged git release
 * Install with `conda` packages: Use a `conda install` command to get the right packages

### Install with setup.py

Clone each of the repos, fetch all the branches/tags, and checkout what you need, then run the `setup.py` script from each repo. Here's an example of installing the 0.8.2 tagged release of Tax-Calculator with `setup.py` (and similar things can be done with the other open-source-economics packages):

```
git clone https://github.com/open-source-economics/Tax-Calculator
cd Tax-Calculator
git fetch --all
git checkout 0.8.2
source activate aei_dropq
python setup.py develop
```
The `python setup.py develop` command will install the code from its current location, allowing you to edit your cloned repo without having to reinstall each time you edit (in contrast to `python setup.py install`).

### Install with conda

Typically this command works to install the latest public releases:

```
conda install -c ospc btax taxcalc ogusa
```

Sometimes you may want to install packages from the `dev` label within the `ospc` anaconda.org group.  The `dev` label includes tentative release candidate packages.  Here's an example:

```
conda install -c ospc/label/dev btax taxcalc ogusa
```

You can optionally force the versions and/or the usage of the `dev` label.  Here's an example of forcing versions for the open-source-economics packages taking packages from the `dev` or `main` label of `ospc` org as needed

```
conda install -c ospc -c ospc/label/dev taxcalc=0.8.4 btax=0.1.6 ogusa=0.5.8
```

## Troubleshooting

If you cannot get the versions installed, follow the following steps:

 * Make sure you are on your `aei_dropq` environment
 * Paste the output of `conda list` and your error message(s) to a github issue in one of the open-source-economics repos, if you can figure out which repo may be the problem, otherwise email me (Peter Steinberg - psteinberg [at] continuum [dot] io) or Matt Jensen (Matt.Jensen [at] aei [dot] org).